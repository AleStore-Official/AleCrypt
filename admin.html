<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>AleCrypt – Admin Panel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <button id="themeToggle" title="Tema">🌙</button>
  <div class="centered">
    <h2>🧑‍💼 Pannello Amministratore AleCrypt</h2>
    <p>Visualizza e gestisci utenti e messaggi direttamente da Supabase.</p>

    <button onclick="caricaUtenti()">📋 Visualizza utenti</button>
    <button onclick="caricaMessaggi()">🗂️ Visualizza messaggi</button>
    <button onclick="location.href='diagnostics.html'">🧭 Diagnostica Supabase</button>
    <button onclick="location.href='index.html'">🏠 Torna alla Home</button>

    <pre id="output" style="margin-top:1em;">🕵️‍♂️ Dati visualizzati qui...</pre>
  </div>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <script>
    window.addEventListener("load", () => {
      // ⛑️ Verifica che Supabase sia disponibile
      if (typeof window.supabase === "undefined" || !window.supabase.createClient) {
        console.error("❌ Supabase non disponibile.");
        return;
      }

      const client = window.supabase.createClient(
        "https://anfgsrtcbpvaihrtqnlv.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFuZmdzcnRjYnB2YWlocnRxbmx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NTI1NTIsImV4cCI6MjA2NzMyODU1Mn0.4tNAZ0RXc-zFFCNT8Wm6Bdo3TkhLc0Up90KxAdUhYss"
      );

      const output = document.getElementById("output");

      window.caricaUtenti = async function () {
        const { data, error } = await client
          .from("utenti")
          .select("*")
          .order("data_registrazione", { ascending: false })
          .limit(100);
        output.textContent = error
          ? "❌ Errore nel recupero utenti:\n" + error.message
          : "👥 Utenti:\n\n" + JSON.stringify(data, null, 2);
      };

      window.caricaMessaggi = async function () {
        const { data, error } = await client
          .from("messaggi")
          .select("*")
          .order("data", { ascending: false })
          .limit(100);
        output.textContent = error
          ? "❌ Errore nel recupero messaggi:\n" + error.message
          : "📬 Messaggi:\n\n" + JSON.stringify(data, null, 2);
      };

      // 🌙 Toggle tema
      const toggle = document.getElementById("themeToggle");
      if (localStorage.getItem("alecrypt-theme") === "dark") {
        document.body.classList.add("dark");
        toggle.innerText = "☀️";
      }
      toggle.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        const t = document.body.classList.contains("dark") ? "dark" : "light";
        localStorage.setItem("alecrypt-theme", t);
        toggle.innerText = t === "dark" ? "☀️" : "🌙";
      });
    });
  </script>
</body>
</html>